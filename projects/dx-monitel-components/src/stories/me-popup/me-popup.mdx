import { Meta, Story, Controls, Source, Canvas } from "@storybook/addon-docs";
import * as popupStories from "./me-popup.stories";
import { Figma } from "@storybook/addon-designs/blocks";

<Meta name="Popup Documentation" of={popupStories} />

# Popup

## Директива mePopup

Применение директивы mePopup к элементу <code>dx-popup</code> приводит его размеры к значению <code>size=medium</code> из дизайн-системы, а также приводит отступы в соответствие
с дизайн-системой, добавляет свойство <code>size</code>. Стандартное свойство <code>resizeEnabled</code> по умолчанию включено.

[Ссылка на API компонента DevExtreme](https://js.devexpress.com/Angular/Documentation/ApiReference/UI_Components/dxPopup/)

<Canvas of={popupStories.Default} />
<Controls of={popupStories.Default} />
<Source of={popupStories.Default} dark />

## Дизайн

<Figma
  height="50%"
  collapsable
  defaultCollapsed
  url="https://www.figma.com/design/S2KXryEyWLA9cplaicYrVn/Components?node-id=568-31799&t=AcVCK3Dt91yWxh5R-0"
/>

## Примеры использования:

- [добавление скролла](#добавление-скролла)
- [добавление элементов и контента в попап](#добавление-элементов-и-контента-в-popup)
- [отображение и скрытие попапа](#отображение-и-скрытие-попапа)
- [ширина и высота окна в зависимости от свойства size](#ширина-и-высота-окна-в-зависимости-от-свойства-size)
- [добавление иконки](#добавление-иконки)
- [свойства](#перечень-свойств)

## Добавление скролла

Чтобы получить внутри окна скролл из дизайн-системы необходимо обернуть контент в компонент <code>scroll view</code>.

<Canvas of={popupStories.Scroll} />

<Source code={`
<dx-popup mePopup>
    <div *dxTemplate="let data of 'content'">
        <dx-scroll-view width="100%" height="100%">
        <!-- Ваш контент -->
        </dx-scroll-view>
    </div>
</dx-popup>
`} dark language='html'/>

## Добавление элементов и контента в popup

Для добавления элементов в туллбар необходимо воспользоваться <code>dxi-toolbar-item</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Specify_Toolbar_Items/). Для добавления контента используется свойство <code>contentTemplate</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Customize_the_Content/#Specifying_the_Content_Template).
В дизайн-системе для размера <code>medium</code> используются кнопки с размером <code>medium</code>, для размера <code>large</code> соответственно кнопки одноименного размера.

<Canvas of={popupStories.Toolbar} />

<Source
  code={`<dx-popup mePopup [showTitle]="true" title="Заголовок">
    <dxi-toolbar-item template="overflowButton" toolbar="top" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="confirmButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="cancelButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="addButton" toolbar="bottom" location="before">
      </dxi-toolbar-item>
    <div *dxTemplate="let data of 'content'">
      <dx-scroll-view width="100%" height="100%">
        {{ lorem25 }}
      </dx-scroll-view>
    </div>
    <div *dxTemplate="let data of 'overflowButton'">
      <dx-button meButton iconOnly="overflow" stylingMode="text" iconSize="12px">
        </dx-button>
    </div>
    <div *dxTemplate="let data of 'confirmButton'">
      <dx-button meButton text="Принять" type="default"></dx-button>
    </div>
    <div *dxTemplate="let data of 'cancelButton'">
      <dx-button meButton text="Отмена" (onClick)="hidePopup()"></dx-button>
    </div>
    <div *dxTemplate="let data of 'addButton'">
      <dx-button meButton text="Добавить"></dx-button>
    </div>
</dx-popup>`}
  dark
  language="html"
/>

## Отображение и скрытие попапа

В документации DevExtreme (DX) предлагается связывать свойство <code>visible</code> с кастомным флагом компонента и управлять отображением через этот флаг. При закрытии попапа средствами DX (при клике вне окна или при клике по предоставляемой DX кнопке окно закрывается не переключив флаг), предполагается, что переключение флага в таком случае будет происходить с помощью события <code>onHidden</code>, которое вызывается при закрытии окна.

Однако, если попап имеет кастомную кнопку закрытия (например, кнопка отмены) флаг переключается и по нажатию кнопки и по событию <code>onHidden</code>, чтобы этого избежать приходится сооружать костыли.

Предлагаю вместо кастомного флага находить все попапы на странице с помощью <code>@ViewChildren</code> и закрывать нужный, передавая соответствующий индекс попапа и используя встроенные методы DX <code>show()</code> и <code>hide()</code>. Например:

- определение методов в компоненте

<Source
  code={`
export class MeComponent {
    \`@\`ViewChildren(DxPopupComponent) popupList?: QueryList<DxPopupComponent>;

    showPopup = (popupIndex: number) => {
        if (this.popupList) {
        this.popupList.get(popupIndex)?.instance?.show();
        }
    };

    hidePopup(popupIndex: number) {
        if (this.popupList) {
        this.popupList.get(popupIndex)?.instance?.hide();
        }
    }

}
`}
dark
language="js"
/>

- использование в шаблоне

<Source
  code={`<dx-button text="Open popup" (onClick)="showPopup(0)"></dx-button>`}
  dark
  language="html"
/>

<Source
  code={`<div *dxTemplate="let data of 'cancelButton'">
    <dx-button meButton text="Отмена" (onClick)="hidePopup(4)"></dx-button>
</div>`}
  dark
  language="html"
/>

## Ширина и высота окна в зависимости от свойства size

Для размера <code>size = medium</code> определены по умолчанию следующие значения:

<Source
  code={`minHeight = 280px;
maxHeight = 80vh;
width = 360px;`}
  dark
/>

Для размера <code>size = large</code> определены по умолчанию следующие значения:

<Source
  code={`minHeight = 320px;
maxHeight = 80vh;
width = 400px;`}
  dark
/>

## Добавление иконки

Для добавления иконки необходимо определить шаблон с использованием директивы [meIcon](https://cl-tfs2022.monitel.local/CK-11/Development/_wiki/wikis/Development.wiki/3453/meIcon), например так

<Source
  code={` <div *dxTemplate="let data of 'icon'">
    <span meIcon icon="public" iconSize="20"></span>
</div>`}
  dark
  language="html"
/>

Добавить шаблон иконки в тулбар с помощью [dxi-toolbar-item](https://js.devexpress.com/Angular/Documentation/ApiReference/UI_Components/dxPopup/Configuration/toolbarItems/)

<Source
  code={
    '<dxi-toolbar-item template="icon" location="before"> </dxi-toolbar-item>'
  }
  dark
  language="html"
/>

## Перечень свойств

<Controls of={popupStories.Size} include={["size"]} />

В дизайн-системе для размера <code>medium</code> используются кнопки с размером <code>medium</code>, для размера <code>large</code> соответственно кнопки одноименного размера.

<Canvas of={popupStories.Size} />

<Source
  code={`<dx-popup mePopup [showTitle]="true" title="Заголовок" size="large">
    <dxi-toolbar-item template="overflowButton" toolbar="top" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="confirmButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="cancelButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="addButton" toolbar="bottom" location="before">
      </dxi-toolbar-item>
    <div *dxTemplate="let data of 'content'">
      <dx-scroll-view width="100%" height="100%">
        {{ lorem500 }}
      </dx-scroll-view>
    </div>
    <div *dxTemplate="let data of 'overflowButton'">
      <dx-button meButton size="large" iconOnly="overflow" stylingMode="text" 
        iconSize="16px"></dx-button>
    </div>
    <div *dxTemplate="let data of 'confirmButton'">
      <dx-button meButton size="large" text="Принять" type="default"></dx-button>
    </div>
    <div *dxTemplate="let data of 'cancelButton'">
      <dx-button meButton size="large" text="Отмена" (onClick)="hidePopup()">
        </dx-button>
    </div>
    <div *dxTemplate="let data of 'addButton'">
      <dx-button meButton size="large" text="Добавить"></dx-button>
    </div>
</dx-popup>`}
  dark
  language="html"
/>

{/* ??? */}

<style>
  {`
      h2 {
        border-bottom: none !important;
    }
`}
</style>
