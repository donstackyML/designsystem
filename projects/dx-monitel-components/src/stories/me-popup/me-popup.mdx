import { Meta, Story, Controls, Source, Canvas } from "@storybook/addon-docs";
import * as popupStories from "./me-popup.stories";
import { Figma } from "@storybook/addon-designs/blocks";

<Meta name="Popup Documentation" of={popupStories} />

# Popup

## Директива mePopup

Применение директивы mePopup к элементу <code>dx-popup</code> приводит его размеры к значению <code>size=medium</code> из дизайн-системы, а также приводит отступы в соответствие
с дизайн-системой, добавляет свойство <code>size</code>. Стандартное свойство <code>resizeEnabled</code> по умолчанию включено.

Документация на сайте разработчика Devextreme:

{/* - [API](https://js.devexpress.com/Angular/Documentation/ApiReference/UI_Components/dxPopup/) */}

{/* - [Демо](https://js.devexpress.com/Angular/Demos/WidgetsGallery/Demo/Popup/Overview/Light/) */}

- <a
    href="https://js.devexpress.com/Angular/Documentation/ApiReference/UI_Components/dxPopup/"
    target="_blank"
  >
    API
  </a>

- <a
    href="https://js.devexpress.com/Angular/Demos/WidgetsGallery/Demo/Popup/Overview/Light/"
    target="_blank"
  >
    Демо
  </a>

<Canvas of={popupStories.Default} />
<Controls of={popupStories.Default} />
<Source of={popupStories.Default} dark />

## Дизайн

<Figma
  height="50%"
  collapsable
  url="https://www.figma.com/design/S2KXryEyWLA9cplaicYrVn/Components?node-id=568-31799&t=AcVCK3Dt91yWxh5R-0"
/>

## Примеры использования

- [Добавление заголовка](#добавление-заголовка)
- [Добавление иконки, описания и кнопки more](#добавление-иконки-описания-и-кнопки-more)
- [Добавление скролла](#добавление-скролла)
- [Добавление кнопки в подвал](#добавление-кнопки-в-подвал)
- [Добавление двух кнопок в подвал](#добавление-двух-кнопок-в-подвал)
- [Добавление элементов и контента в попап](#добавление-элементов-и-контента-в-popup)
- [Попап в формате диалогового окна (средний размер)](#попап-в-фомате-диалогового-окна-средний-размер)
- [Попап в формате диалогового окна (большой размер)](#попап-в-фомате-диалогового-окна-большой-размер)
- [Отображение и скрытие попапа](#отображение-и-скрытие-попапа)
- [Добавление иконки](#добавление-иконки)
- [Ширина и высота окна в зависимости от свойства size](#ширина-и-высота-окна-в-зависимости-от-свойства-size)

## Добавление заголовка

Добавление заголовка осуществляется в поле <code>title</code> компонента, поле <code>showTitle</code> должно быть <code>true</code>
(можно его не прописывать, т.к. оно по умолчанию <code>true</code>).

<Canvas of={popupStories.Title} />

<Source code={`
<dx-popup mePopup [showTitle]="true" title="Заголовок">
  <!-- Ваш контент -->
</dx-popup>
`} dark language='html'/>

## Добавление иконки, описания и кнопки more

Чтобы добавить иконку, описание и кнопку more нужно сделать кастомный темплейт с использованием <code>dxTemplate</code>, также добавить параметр <code>titleTemplate="title"</code>.
В темплейте использовать классы <code>me-popup-header</code>, для отображения заголовка с описанием под ним использовать класс <code>me-sidepage-title</code>.

<Canvas of={popupStories.IconDescription} />

<Source
  code={`
<dx-popup mePopup titleTemplate="title" >
  <div *dxTemplate="let data of 'title'">
    <div class="me-popup-header">
      <div meIcon icon="public" size="24"></div>
      <div class="me-sidepage-title">
        <span class="me-title-header1">Заголовок</span>
        <span class="me-text-body2">Описание</span>
      </div>
        <dx-button meButton size="large" iconOnly="overflow" stylingMode="text"></dx-button>
        <dx-button meButton stylingMode="text" iconOnly="close"></dx-button>
    </div>
  </div>
</dx-popup>
`}
  dark
  language="html"
/>

## Добавление скролла

Чтобы получить внутри окна скролл из дизайн-системы необходимо обернуть контент в компонент <code>scroll view</code>.

<Canvas of={popupStories.Scroll} />

<Source code={`
<dx-popup mePopup>
    <div *dxTemplate="let data of 'content'">
        <dx-scroll-view width="100%" height="100%">
        <!-- Ваш контент -->
        </dx-scroll-view>
    </div>
</dx-popup>
`} dark language='html'/>

## Добавление кнопки в подвал

Для добавления элементов в туллбар необходимо воспользоваться <code>dxi-toolbar-item</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Specify_Toolbar_Items/). Для добавления контента используется свойство <code>contentTemplate</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Customize_the_Content/#Specifying_the_Content_Template).

Ниже приведен пример добавления кнопки в подвал.

<Canvas of={popupStories.Button} />

<Source
  code={`
<dx-popup mePopup title="Заголовок">
  <dxi-toolbar-item template="addButton" toolbar="bottom" location="center"> </dxi-toolbar-item>
  <div *dxTemplate="let data of 'addButton'">
    <dx-button meButton text="Добавить"></dx-button>
  </div>
</dx-popup>`}
  language="html"
  dark
/>

## Добавление двух кнопок в подвал

Для добавления элементов в туллбар необходимо воспользоваться <code>dxi-toolbar-item</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Specify_Toolbar_Items/). Для добавления контента используется свойство <code>contentTemplate</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Customize_the_Content/#Specifying_the_Content_Template).

Ниже приведен пример добавления двух кнопок в подвал.

<Canvas of={popupStories.Buttons} />

<Source
  code={`
<dx-popup mePopup title="Заголовок">
     <dxi-toolbar-item template="addButton" toolbar="bottom" location="after"></dxi-toolbar-item>
     <dxi-toolbar-item template="cancelButton" toolbar="bottom" location="after"></dxi-toolbar-item>
      <div *dxTemplate="let data of 'addButton'">
        <dx-button meButton type="default" text="Добавить"></dx-button>
      </div>
      <div *dxTemplate="let data of 'cancelButton'">
        <dx-button meButton text="Отмена"></dx-button>
      </div>
</dx-popup>`}
  laguage="html"
  dark
/>

## Добавление элементов и контента в popup

Для добавления элементов в туллбар необходимо воспользоваться <code>dxi-toolbar-item</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Specify_Toolbar_Items/). Для добавления контента используется свойство <code>contentTemplate</code> [как пользоваться](https://js.devexpress.com/Angular/Documentation/21_2/Guide/UI_Components/Popup/Customize_the_Appearance/Customize_the_Content/#Specifying_the_Content_Template).
В дизайн-системе для размера <code>medium</code> используются кнопки с размером <code>medium</code>, для размера <code>large</code> соответственно кнопки одноименного размера.

<Canvas of={popupStories.Toolbar} />

<Source
  code={`<dx-popup mePopup [showTitle]="true" title="Заголовок">
    <dxi-toolbar-item template="overflowButton" toolbar="top" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="confirmButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="cancelButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="addButton" toolbar="bottom" location="before">
      </dxi-toolbar-item>
    <div *dxTemplate="let data of 'content'">
      <dx-scroll-view width="100%" height="100%">
        {{ lorem25 }}
      </dx-scroll-view>
    </div>
    <div *dxTemplate="let data of 'overflowButton'">
      <dx-button meButton iconOnly="overflow" stylingMode="text" iconSize="12px">
        </dx-button>
    </div>
    <div *dxTemplate="let data of 'confirmButton'">
      <dx-button meButton text="Принять" type="default"></dx-button>
    </div>
    <div *dxTemplate="let data of 'cancelButton'">
      <dx-button meButton text="Отмена" (onClick)="hidePopup()"></dx-button>
    </div>
    <div *dxTemplate="let data of 'addButton'">
      <dx-button meButton text="Добавить"></dx-button>
    </div>
</dx-popup>`}
  dark
  language="html"
/>

## Попап в фомате диалогового окна (средний размер)

<Canvas of={popupStories.Dialog} />

<Source
  code={`
<dx-popup mePopup titleTemplate="title" [showTitle]="false"
      <dxi-toolbar-item template="confirmButton" toolbar="bottom"> </dxi-toolbar-item>
      <dxi-toolbar-item template="cancelButton" toolbar="bottom"> </dxi-toolbar-item>
      <div *dxTemplate="let data of 'content'">
        <dx-scroll-view width="100%" height="100%">
          <div class="me-flex-column" style="align-items: center;">
            <h3 class="me-title-header1" style="margin: 0;">Заголовок</h3>
            <div class="me-text-body2">$\{lorem25}</div>
          </div>
        </dx-scroll-view>
      </div>
      <div *dxTemplate="let data of 'confirmButton'">
        <dx-button
          meButton
          size="medium"
          text="Принять"
          type="default"
          (onClick)="hidePopup(12)"
        ></dx-button>
      </div>
      <div *dxTemplate="let data of 'cancelButton'">
        <dx-button meButton size="medium" text="Отклонить" (onClick)="hidePopup(12)"></dx-button>
      </div>
</dx-popup>
`}
  laguage="html"
  dark
/>

## Попап в фомате диалогового окна (большой размер)

<Canvas of={popupStories.DialogLarge} />

<Source
  code={`
<dx-popup mePopup titleTemplate="title" [showTitle]="true"
      <dxi-toolbar-item template="confirmButton" toolbar="bottom"> </dxi-toolbar-item>
      <dxi-toolbar-item template="cancelButton" toolbar="bottom"> </dxi-toolbar-item>
      <div *dxTemplate="let data of 'content'">
        <dx-scroll-view width="100%" height="100%">
          <div class="me-flex-column" style="align-items: center;">
            <h3 class="me-title-header1" style="margin: 0;">Заголовок</h3>
            <div class="me-text-body2">$\{lorem25}</div>
          </div>
        </dx-scroll-view>
      </div>
      <div *dxTemplate="let data of 'confirmButton'">
        <dx-button
          meButton
          size="large"
          text="Принять"
          type="default"
        ></dx-button>
      </div>
      <div *dxTemplate="let data of 'cancelButton'">
        <dx-button meButton size="large" text="Отклонить"></dx-button>
      </div>
</dx-popup>
`}
  language="html"
  dark
/>

## Отображение и скрытие попапа

В документации DevExtreme (DX) предлагается связывать свойство <code>visible</code> с кастомным флагом компонента и управлять отображением через этот флаг. При закрытии попапа средствами DX (при клике вне окна или при клике по предоставляемой DX кнопке окно закрывается не переключив флаг), предполагается, что переключение флага в таком случае будет происходить с помощью события <code>onHidden</code>, которое вызывается при закрытии окна.

Однако, если попап имеет кастомную кнопку закрытия (например, кнопка отмены) флаг переключается и по нажатию кнопки и по событию <code>onHidden</code>, чтобы этого избежать приходится сооружать костыли.

Предлагаю вместо кастомного флага находить все попапы на странице с помощью <code>@ViewChildren</code> и закрывать нужный, передавая соответствующий индекс попапа и используя встроенные методы DX <code>show()</code> и <code>hide()</code>. Например:

### Определение методов в компоненте

<Source
  code={`
export class MeComponent {
    \`@\`ViewChildren(DxPopupComponent) popupList?: QueryList<DxPopupComponent>;

    showPopup = (popupIndex: number) => {
        if (this.popupList) {
        this.popupList.get(popupIndex)?.instance?.show();
        }
    };

    hidePopup(popupIndex: number) {
        if (this.popupList) {
        this.popupList.get(popupIndex)?.instance?.hide();
        }
    }

}
`}
dark
language="js"
/>

### Использование в шаблоне

<Source
  code={`<dx-button text="Open popup" (onClick)="showPopup(0)"></dx-button>`}
  dark
  language="html"
/>

<Source
  code={`<div *dxTemplate="let data of 'cancelButton'">
    <dx-button meButton text="Отмена" (onClick)="hidePopup(4)"></dx-button>
</div>`}
  dark
  language="html"
/>

Так же при использовании одного попапа можно использовать <code>instance.show()</code>.

<Source code={`
  @ViewChild(DxPopupComponent, { static: false }) popup:
    | DxPopupComponent
    | undefined;

onShow() {
this.popup?.instance.show();
}

onClose() {
this.popup?.instance.hide();
}

`} dark language="js"/>

## Добавление иконки

Для добавления иконки необходимо определить шаблон с использованием директивы [meIcon](https://cl-tfs2022.monitel.local/CK-11/Development/_wiki/wikis/Development.wiki/3453/meIcon), например так:

<Source
  code={` <div *dxTemplate="let data of 'icon'">
    <span meIcon icon="public" iconSize="20"></span>
</div>`}
  dark
  language="html"
/>

Добавить шаблон иконки в тулбар с помощью [dxi-toolbar-item](https://js.devexpress.com/Angular/Documentation/ApiReference/UI_Components/dxPopup/Configuration/toolbarItems/).

<Source
  code={
    '<dxi-toolbar-item template="icon" location="before"> </dxi-toolbar-item>'
  }
  dark
  language="html"
/>

## Ширина и высота окна в зависимости от свойства size

В дизайн-системе для размера <code>medium</code> используются кнопки с размером <code>medium</code>, для размера <code>large</code> соответственно кнопки одноименного размера.

Для размера <code>size = medium</code> определены по умолчанию следующие значения:

<Source
  code={`minHeight = 280px;
maxHeight = 80vh;
width = 360px;`}
  dark
/>

<Canvas of={popupStories.SizeMedium} />

Для размера <code>size = large</code> определены по умолчанию следующие значения:

<Source
  code={`minHeight = 320px;
maxHeight = 80vh;
width = 400px;`}
  dark
/>

<Canvas of={popupStories.Size} />

<Source
  code={`<dx-popup mePopup [showTitle]="true" title="Заголовок" size="large">
    <dxi-toolbar-item template="overflowButton" toolbar="top" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="confirmButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="cancelButton" toolbar="bottom" location="after">
      </dxi-toolbar-item>
    <dxi-toolbar-item template="addButton" toolbar="bottom" location="before">
      </dxi-toolbar-item>
    <div *dxTemplate="let data of 'content'">
      <dx-scroll-view width="100%" height="100%">
        {{ lorem500 }}
      </dx-scroll-view>
    </div>
    <div *dxTemplate="let data of 'overflowButton'">
      <dx-button meButton size="large" iconOnly="overflow" stylingMode="text"
        iconSize="16px"></dx-button>
    </div>
    <div *dxTemplate="let data of 'confirmButton'">
      <dx-button meButton size="large" text="Принять" type="default"></dx-button>
    </div>
    <div *dxTemplate="let data of 'cancelButton'">
      <dx-button meButton size="large" text="Отмена" (onClick)="hidePopup()">
        </dx-button>
    </div>
    <div *dxTemplate="let data of 'addButton'">
      <dx-button meButton size="large" text="Добавить"></dx-button>
    </div>
</dx-popup>`}
  dark
  language="html"
/>

<style>
  {`
    h2 {
        border-bottom: none !important;
    }

    a {
      display: inline-block !important;
    }

    a p {
      color: #029CFD !important;
    }
`}
</style>
