import { Meta, Source } from "@storybook/blocks";

<Meta title="Documentation/Локализация библиотек" />

# Локализация библиотек (i18next)

Приложение, в котором используется библиотека, должно быть уже [локализовано](https://web-storybook.sandbox.local/24/?path=/docs/documentation-%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9-%D0%B8-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA--docs).

#### 1. Добавить файл autolocal.json в библиотеку, например, ./lib/assets/i18n/autolocal.json

Пример словаря **autolocal.json**

<Source
  code={`{
  "lang": "ru",
  "HEADER": {
    "APP_NAME": "Название приложения",
    "CONTENT_NAME": "Название контента"
  },
  "DDB": {
    "DEFAULT_USER": "Личный кабинет",
    "USER": "Пользователь",
    "CHANGE": "Сменить...",
    "EXIT": "Выход...",
    "DOMAIN": "Домен",
    "CONNECT": "Подключиться..."
  }
}`}
  language="js"
  dark
/>

#### 2. Добавить файл localization.service.ts в папку ./lib/src/i18n

Сервис читает файл по указанному пути и добавляет его в глобальный словать i18next.

<Source
  code={`import { Injectable } from '@angular/core';
import i18next from 'i18next';

@Injectable({
  providedIn: 'root'
})
export class LocalizationService {

  constructor() {
    try {
      const data = this.loadJSON('assets/{название вашего приложения}/i18n/autolocal.json');

      i18next.addResourceBundle(data.lang, 'translation', data, true, false);
    } catch (error) {
      console.error(error);
    }
  }

  loadJSON(filename: string) {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', filename, false);
    xhr.send();

    if (xhr.status === 200) {
      return JSON.parse(xhr.responseText);
    } else {
      throw new Error(\`Failed to load JSON: \${xhr.status} \${xhr.statusText}\`);
    }
  }
}`}
language="js"
dark
/>

#### 3. Инжектировать сервис в модуль или компонент

<Source
  code={`import { LocalizationService } from 'lib/src/i18n/localization.service';

@NgModule({
  ...
})
export class LibModule {

  constructor(private localizationService: LocalizationService) {
    ...
  }
}`}
  language="js"
  dark
/>

#### 4. Перенести папку i18n из библиотеки в папку assets приложения в angular.json

<Source
  code={`
  angular.json

"assets": [
            "src/favicon.ico",
            "src/assets/*",
            {
              "glob": "**/*",
              "input": "./lib/assets",
              "output": "assets/{название вашего приложения}"
            }
          ],`}
  language="js"
  dark
/>

<style>
  {`
      h2 {
        border-bottom: none !important;
    }
`}
</style>
